---
title: 协同过滤（Collaborative Filtering，CF）
date: 2024-11-27 22:26:27
categories: 
  - 推荐系统基础
tags: 
  - 协同过滤
mathjax: true

---
# 协同过滤
## 什么是协同过滤？
协同过滤（Collaborative Filtering，CF）是一种基于用户行为数据的推荐算法。
它的核心思想是利用用户群体的行为来找到相似的用户或者相似的物品，从而为用户推荐可能感兴趣的物品。
例如，在一个电商平台上，如果用户 A 和用户 B 购买的商品有很多重叠部分，当用户 A 购买了一个新商品，而用户 B 还没购买时，就可以把这个商品推荐给用户 B。
这种方法不依赖于物品本身的内容属性（如电影的类型、书籍的主题等），而是侧重于用户对物品的行为（如购买、评分、浏览等）。
通过分析大量用户的行为数据，挖掘出用户之间的相似性和物品之间的关联，以此来生成推荐列表。

## 基于用户的协同过滤（User - CF - Based）
### 基于用户的协同过滤（User - CF - Based）是什么？
基于用户的协同过滤是协同过滤算法的一种类型。它主要关注用户之间的相似性。
以社交网络中的音乐推荐为例，它会先找出和你在音乐喜好上相似的其他用户（比如你们都喜欢流行音乐，对某些歌手的评分很接近），然后根据这些相似用户所喜欢的音乐来为你推荐歌曲。

### 基于用户的协同过滤（User - CF - Based）的思想是什么？
其思想是 “人以群分”。假设具有相似兴趣爱好的用户，他们对其他物品的偏好也会相似。
如果用户 A 和用户 B 在过去对很多音乐的评价都很相似，那么当用户 A 发现了一首新的好听的歌曲并给予好评时，就有理由相信用户 B 也可能会喜欢这首歌曲，所以把这首歌曲推荐给用户 B。

### 基于用户的协同过滤（User - CF - Based）的推荐例子？
假设我们有一个简单的电影评分系统，有以下5个用户（A、B、C、D、E）和5部电影（《电影1》、《电影2》、《电影3》、《电影4》、《电影5》），评分范围是1 - 5分，数据如下表所示：

|用户|《电影1》|《电影2》|《电影3》|《电影4》|《电影5》|
|----|----|----|----|----|----|
|A|5|3|0|1|0|
|B|4|0|0|1|3|
|C|1|1|0|5|0|
|D|0|0|5|4|0|
|E|3|0|0|0|5|

#### 推荐步骤

1. **数据收集**
   - 我们已经有了上述用户对电影的评分数据，这是我们进行协同过滤的基础。这些数据可以存储在数据库中，方便后续处理。
2. **相似性计算（以余弦相似度为例）**
   - 计算用户A和用户B的相似度。
     - 用户A的评分向量为$A=(5,3,0,1,0)$，用户B的评分向量为$B=(4,0,0,1,3)$。
     - 根据余弦相似度公式$\cos(A,B)=\frac{A\cdot B}{\left\|A\right\|\left\|B\right\|}$，先计算向量的内积$A\cdot B = 5\times4 + 3\times0+0\times0 + 1\times1+0\times3=21$。
     - 计算向量A的模$\left\|A\right\|=\sqrt{5^{2}+3^{2}+0^{2}+1^{2}+0^{2}}=\sqrt{35}$，向量B的模$\left\|B\right\|=\sqrt{4^{2}+0^{2}+0^{2}+1^{2}+3^{2}}=\sqrt{26}$。
     - 则$\cos(A,B)=\frac{21}{\sqrt{35}\times\sqrt{26}}\approx0.67$。
   - 同样地，计算用户A和其他用户（C、D、E）的相似度。
     - 用户A和用户C的评分向量分别为$A=(5,3,0,1,0)$和$C=(1,1,0,5,0)$，计算可得$\cos(A,C)=\frac{5\times1 + 3\times1+0\times0 + 1\times5+0\times0}{\sqrt{35}\times\sqrt{27}}\approx0.49$。
     - 用户A和用户D的评分向量分别为$A=(5,3,0,1,0)$和$D=(0,0,5,4,0)$，计算可得$\cos(A,D)=\frac{5\times0 + 3\times0+0\times5 + 1\times4+0\times0}{\sqrt{35}\times\sqrt{41}}\approx0.19$。
     - 用户A和用户E的评分向量分别为$A=(5,3,0,1,0)$和$E=(3,0,0,0,5)$，计算可得$\cos(A,E)=\frac{5\times3 + 3\times0+0\times0 + 1\times0+0\times5}{\sqrt{35}\times\sqrt{34}}\approx0.44$。
3. **推荐生成**
   - 从上面的计算可以看出，用户A和用户B的相似度最高。用户B对《电影5》评分为3分，而用户A还没对《电影5》评分。所以可以将《电影5》推荐给用户A。同时，因为用户A和用户C也有一定的相似度，用户C对《电影4》评分为5分，用户A对《电影4》评分为1分，这个评分差异可能需要进一步考虑，但也可以作为一个参考，看看是否要对《电影4》的推荐权重进行调整。例如，可以根据相似度和评分差异来综合计算一个推荐分数，对于《电影5》推荐分数可以设为相似度$0.67\times3 = 2.01$，对于《电影4》可以设为$0.49\times(5 - 1)=1.96$（这里简单地用相似度乘以评分差来表示推荐分数调整的概念）。根据这个简单的推荐分数，《电影5》的推荐优先级可能会高于《电影4》，优先推荐给用户A。

#### 优缺点
##### 优点
  - 简单直观，易于理解和解释
  - 计算简单，不需要复杂的模型和参数
  - 可以发现潜在的兴趣点，相似的人有了新的兴趣点，可以推给其他人
##### 缺点
  - 冷启动受限，新用户没有足够的行为数据难以找到相似的人进行良好的推荐
  - 良好的推荐对数据和相似度计算的算法要求高，比如评分数据稀疏，方差大，不同的相似度计算有不同的优缺点如何平衡
  - 随着用户数量和物品的增加，都会增加计算量

## 基于物品的协同过滤（Item - CF - Based）
### 基于物品的协同过滤（Item - CF - Based）是什么？
基于物品的协同过滤主要是关注物品之间的相似性来进行推荐，但不关注物品本身属性的相似性。
而是利用物品的共现关系，比如A和B经常一起出现在用户U的购物篮中，那么A和B可能存在一定的相似性。
当用户U购买了A，那么B也可能被推荐给U。
### 基于物品的协同过滤（Item - CF - Based）的思想是什么？
其思想是基于物品之间的关联性。如果很多用户对物品 A 和物品 B 都有相似的行为（如都喜欢或者都购买），那么可以认为物品 A 和物品 B 是相似的。当一个用户对物品 A 表现出兴趣时，就可以推荐与之相似的物品 B。比如，在图书推荐中，如果两本书经常被同一批读者借阅，那么这两本书很可能在内容、风格等方面有相似之处，就可以互相推荐。
### 基于物品的协同过滤（Item - CF - Based）的推荐例子？
假设有一个在线书店，有5位读者（甲、乙、丙、丁、戊）对4本书（《书籍A》、《书籍B》、《书籍C》、《书籍D》）进行了购买（用1表示购买，0表示未购买），数据如下表所示：

|读者|《书籍A》|《书籍B》|《书籍C》|《书籍D》|
|----|----|----|----|----|
|甲|1|1|0|0|
|乙|1|0|1|0|
|丙|0|1|1|0|
|丁|0|0|1|1|
|戊|1|0|0|1|

#### 推荐步骤

1. **计算物品相似度矩阵（以余弦相似度为例）**
   - 首先计算《书籍A》和《书籍B》的相似度。
     - 《书籍A》的购买向量为$A=(1,1,0,0,1)$，《书籍B》的购买向量为$B=(1,0,1,0,0)$。
     - 根据余弦相似度公式$\cos(A,B)=\frac{A\cdot B}{\left\|A\right\|\left\|B\right\|}$，先计算向量的内积$A\cdot B = 1\times1+1\times0 + 0\times1+0\times0+1\times0 = 1$。
     - 计算向量A的模$\left\|A\right\|=\sqrt{1^{2}+1^{2}+0^{2}+0^{2}+1^{2}}=\sqrt{3}$，向量B的模$\left\|B\right\|=\sqrt{1^{2}+0^{2}+1^{2}+0^{2}+0^{2}}=\sqrt{2}$。
     - 则$\cos(A,B)=\frac{1}{\sqrt{3}\times\sqrt{2}}\approx0.41$。
   - 同样地，计算《书籍A》和其他书籍（《书籍C》、《书籍D》）的相似度。
     - 《书籍A》和《书籍C》的购买向量分别为$A=(1,1,0,0,1)$和$C=(0,1,1,1,0)$，计算可得$\cos(A,C)=\frac{1\times0 + 1\times1+0\times1 + 0\times1+1\times0}{\sqrt{3}\times\sqrt{3}}\approx0.33$。
     - 《书籍A》和《书籍D》的购买向量分别为$A=(1,1,0,0,1)$和$D=(0,0,1,1,1)$，计算可得$\cos(A,D)=\frac{1\times0 + 1\times0+0\times1 + 0\times1+1\times1}{\sqrt{3}\times\sqrt{3}}\approx0.33$。
   - 继续计算《书籍B》和《书籍C》、《书籍D》的相似度，以及《书籍C》和《书籍D》的相似度，得到完整的相似度矩阵如下：

|书籍|《书籍A》|《书籍B》|《书籍C》|《书籍D》|
|----|----|----|----|----|
|《书籍A》|1|0.41|0.33|0.33|
|《书籍B》|0.41|1|0.41|0.00|
|《书籍C》|0.33|0.41|1|0.41|
|《书籍D》|0.33|0.00|0.41|1|

2. **生成推荐列表**
   - 假设我们要为购买了《书籍A》的读者推荐书籍。从相似度矩阵可以看出，《书籍A》与《书籍B》的相似度最高。
   - 对于读者甲，他购买了《书籍A》，我们可以根据相似度和购买情况来计算推荐分数。设推荐分数为相似度乘以是否购买（这里购买为1，未购买为0）的加权和。对于《书籍B》，推荐分数为$0.41\times1 = 0.41$。
   - 对于《书籍C》和《书籍D》，推荐分数分别为$0.33\times0 = 0$（因为甲未购买这两本书）。
   - 按照推荐分数排序，会优先推荐《书籍B》给购买了《书籍A》的读者。同时，如果有其他因素需要考虑，比如书籍的热度等，可以进一步调整推荐分数，使推荐更加合理。例如，如果《书籍C》是一本热门新书，我们可以适当提高它的推荐分数，比如给它一个基础热度分数0.2，那么它的最终推荐分数变为0.2，这样在推荐时就可能会和《书籍B》一起推荐给读者甲。

### 优缺点
#### 优点：
- 准确性较高：在推荐一些专业性较强或者有明确类别划分的物品时，基于物品的相似性推荐往往更准确。例如，在科技产品推荐中，如果用户购买了一款特定型号的手机，推荐与其配置、品牌等相似的手机，用户接受推荐的可能性较高。
- 稳定性好：物品之间的相似性相对比较稳定。例如，电影的类型、书籍的主题等不会像用户兴趣那样频繁变化。所以，一旦计算出物品之间的相似性，在一段时间内可以持续有效地进行推荐。
#### 缺点：
- 冷启动问题：当新用户或者新物品加入时，无法进行推荐。
- 推荐多样性受限：可能会过度依赖物品本身的属性来确定相似性，导致推荐的物品在类型等方面比较相似，缺乏多样性。例如，推荐的电影可能都是同一类型的爱情片，而忽略了用户可能也有兴趣尝试其他类型的电影。

## User - CF - Based 与 Item - CF - Based 对比篇
### User - CF - Based 与 Item - CF - Based 的应用场景的区别
#### 基于用户的协同过滤（User - CF - Based）应用场景：
- 社交网络：在社交平台上推荐好友可能感兴趣的内容，如微博推荐用户可能感兴趣的话题给用户的好友。因为在社交网络中，人的兴趣传播比较重要，而且用户之间的相似性可以更好地体现社交关系。
- 兴趣发现平台：像一些新的兴趣发现类的应用，例如小众音乐发现平台。可以根据相似用户的兴趣来挖掘新的音乐风格，帮助用户拓展音乐口味。
#### 基于物品的协同过滤（Item - CF - Based）应用场景：
- 电商平台：推荐与用户购买过的商品相似的商品。例如，在亚马逊上，当用户购买了一本小说，推荐其他同类型或者作者的小说。因为电商平台的物品属性比较明确，利用物品相似性推荐可以更精准地推荐用户可能需要的商品。
- 内容平台：如视频平台推荐与用户观看过的视频相似的视频。例如，在爱奇艺上，对于喜欢古装剧的用户，推荐其他古装剧。

### User - CF - Based 与 Item - CF - Based 的存在问题的区别
#### 基于用户的协同过滤（User - CF - Based）存在问题：
- 冷启动问题（用户角度）：对于新用户，由于没有足够的行为数据，很难找到相似用户，从而无法进行有效的推荐。例如，一个新注册的用户在电商平台上还没购买任何商品，很难根据用户的协同过滤为他推荐商品。
- 数据稀疏性和计算复杂性：如前面提到的，用户对物品的评价数据稀疏，而且计算用户之间的相似度计算量很大。
#### 基于物品的协同过滤（Item - CF - Based）存在问题：
- 冷启动问题（物品角度）：新物品很难快速找到与之相似的物品进行推荐。例如，新上架的电影没有用户评价和关联，就不容易被推荐。
- 推荐多样性不足：容易受到物品属性的限制，推荐的物品可能在类别等方面比较相似，不能很好地满足用户的多样化需求。

### User - CF - Based 与 Item - CF - Based 问题篇
#### 解决数据稀疏性问题：
- 数据填充方法：对于用户 - 物品评分矩阵中的缺失值，可以采用一些填充方法。例如，使用均值填充，即对于某个用户未评分的物品，用该用户已评分物品的平均分来填充；或者使用基于相似用户或相似物品的填充方法。如果用户 A 和用户 B 很相似，而用户 A 对某物品有评分，那么可以用用户 A 的评分来填充用户 B 对该物品的评分。
- 采用多种数据源：除了用户的评分和购买行为数据，还可以结合其他数据，如用户的浏览行为、搜索记录等。例如，在电商平台上，用户虽然没有购买某商品，但经常浏览该商品的详情页，这也可以作为一种兴趣信号，来缓解数据稀疏性问题。
#### 解决冷启动问题：
- 对于新用户（User - CF - Based）：可以先采用基于内容的推荐。例如，在电影推荐系统中，对于新用户，先根据用户注册时填写的性别、年龄、爱好等信息推荐一些热门电影或者符合其基本信息的电影。当用户有了一定的行为数据后，再结合基于用户的协同过滤。
- 对于新物品（Item - CF - Based）：可以利用物品的内容属性进行初始推荐。比如，对于一本新书，可以根据书的类别、作者等信息推荐给对该类别或作者感兴趣的用户。同时，积极收集用户对新物品的反馈，尽快建立物品之间的相似关系。

## 参考列表
1. 豆包（https://www.doubao.com/）
2. 推荐系统百面百搭 https://github.com/km1994/RES-Interview-Notes